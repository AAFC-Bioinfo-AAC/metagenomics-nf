manifest {
    description = 'Devin Holman and Arun Kommadath Metagenomic workflow (AAFC)'
}

profiles {


    local {
        params {
            genome           = "$baseDir/data/genomes/bowtie_genome_index/cow/"
            genome_basename  = "cow"      // e.g. cow in cow.1.bt2, cow.2.bt2, cow.rev.1.bt2, cow.rev.2.bt2
            reads            = "$baseDir/data/mini_reads/*_R{1,2}.fastq.gz"
            results          = "$baseDir/my_results"
            kaiju_db         = "/mnt/sdb/databases/kaiju_db_nr_euk_20230223"
            kaiju_merge_script = "$baseDir/src/merge_tax_files.R"
        }
	    process {
            executor = 'local'
            memory = 6.GB
            errorStrategy = 'finish'
            withLabel: mem_large { memory = 24.GB }
            withLabel: mem_xlarge { memory = 128.GB }    
            withName: QUALITY_FILTERING {conda = '/home/brouardjs/miniconda3/envs/fastp'}
            withName: BOWTIE2 {conda = '/home/brouardjs/miniconda3/envs/bowtie2'}
	        withName: SAM2BAM {conda = '/home/brouardjs/miniconda3/envs/samtools'}
            withName: SORTBAM {conda = '/home/brouardjs/miniconda3/envs/samtools'}
            withName: OUTPUT_UNALIGNED_READS {conda = '/home/brouardjs/miniconda3/envs/bedtools'}
            withName: 'KAIJU|KAIJU_TAX_TABLE|KAIJU_FULL_TAX_TABLE' {conda = '/home/brouardjs/miniconda3/envs/kaiju'}
            withName: MERGE_TAX_FILES {conda = '/home/brouardjs/miniconda3/envs/R'}
        }
       
    }
    
    
    
    biocluster {
        params {
            genome           = "$baseDir/data/genomes/bowtie_genome_index/cow/"
            genome_basename  = "cow"      // e.g. cow in cow.1.bt2, cow.2.bt2, cow.rev.1.bt2, cow.rev.2.bt2
            reads            = "$baseDir/data/mini_reads/*_R{1,2}.fastq.gz"
            results          = "$baseDir/my_results"
            kaiju_db         = "/isilon/common/reference/databases/kaiju_db/kaiju_db_nr_euk_20230223"
            kaiju_merge_script = "$baseDir/src/merge_tax_files.R"
        }  
	    process {
            executor = 'sge'
            memory = 6.GB
            errorStrategy = 'finish'
            withLabel: mem_large { memory = 24.GB }
            withLabel: mem_xlarge { memory = 128.GB }    
            withName: QUALITY_FILTERING {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/fastp'}
            withName: BOWTIE2 {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/bowtie2'}
	        withName: SAM2BAM {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/samtools'}
            withName: SORTBAM {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/samtools'}
            withName: OUTPUT_UNALIGNED_READS {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/bedtools'}
            withName: 'KAIJU|KAIJU_TAX_TABLE|KAIJU_FULL_TAX_TABLE' {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/kaiju'}
            withName: MERGE_TAX_FILES {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/R'}
        }
    }



}

