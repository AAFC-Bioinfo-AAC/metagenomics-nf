manifest {
    description = 'Devin Holman and Arun Kommadath Metagenomic workflow (AAFC)'
}

profiles {
    local {
        params {
            genome           = "$baseDir/data/genomes/bowtie_genome_index/cow/"
            genome_basename  = "cow"      // e.g. cow in cow.1.bt2, cow.2.bt2, cow.rev.1.bt2, cow.rev.2.bt2
            reads            = "$baseDir/data/mini_reads/*_R{1,2}.fastq.gz"
            aln              = "$baseDir/data/aln/*.bam"
            results          = "$baseDir/my_results"
            kaiju_db         = "/mnt/sdb/databases/kaiju_db_nr_euk_20230223"
            
            kaiju_merge_script = "$baseDir/src/merge_tax_files.R"
            chocophlan_db    = "$baseDir/db/humann3/chocophlan"
            uniref_db        = "$baseDir/db/humann3/uniref"
            metaphlan_db     = "$baseDir/db/humann3/metaphlan_vJan21"
            
            
            
        }
	    process {
            executor = 'local'
            memory = 6.GB
            errorStrategy = 'finish'
            withLabel: mem_large { memory = 24.GB }
            withLabel: mem_xlarge { memory = 128.GB }    
            withName: QUALITY_FILTERING {conda = '/home/brouardjs/miniconda3/envs/fastp'}
            withName: BOWTIE2 {conda = '/home/brouardjs/miniconda3/envs/bowtie2'}
	        withName: SAM2BAM {conda = '/home/brouardjs/miniconda3/envs/samtools'}
            withName: SORTBAM {conda = '/home/brouardjs/miniconda3/envs/samtools'}
            withName: OUTPUT_UNALIGNED_READS {conda = '/home/brouardjs/miniconda3/envs/bedtools'}
            withName: 'KAIJU|KAIJU_TAX_TABLE|KAIJU_FULL_TAX_TABLE' {
                conda = '/home/brouardjs/miniconda3/envs/kaiju'
                memory = 64.GB
            }
            withName: MERGE_TAX_FILES {conda = '/home/brouardjs/miniconda3/envs/R'}
        }
    }
    biocluster {
        params {
            genome           = "$baseDir/data/genomes/bowtie_genome_index/cow/"
            genome_basename  = "cow"      // e.g. cow in cow.1.bt2, cow.2.bt2, cow.rev.1.bt2, cow.rev.2.bt2
            pseudobins       = "$baseDir/data/pseudo_bins/*.fa"
            reads            = "$baseDir/data/reads/*_R{1,2}.fastq.gz"
            aln              = "$baseDir/data/aln/*.bam"
            results          = "$baseDir/my_results"
            kaiju_db         = "/isilon/common/reference/databases/kaiju_db/kaiju_db_nr_euk_20230223"
            kaiju_merge_script = "$baseDir/src/merge_tax_files.R"
            chocophlan_db    = "/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/data/humann3/chocophlan"
            uniref_db        = "/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/data/uniref"
            metaphlan_db     = "/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/data/humann3/metaphlan_vJan21"
            checkm2_db       = "/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/data/CheckM2_database/uniref100.KO.1.dmnd"
        }  
	    process {
            executor = 'sge'
            memory = 6.GB
            penv = 'smp'
            errorStrategy = 'finish'
            withLabel: mem_large { memory = 24.GB }
            withLabel: mem_xlarge { memory = 128.GB }    
            withName: QUALITY_FILTERING {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/fastp'}
            withName: BOWTIE2 {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/bowtie2'
                               memory = 128.GB
                               cpus = 8
            }
	        withLabel: samtools {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/samtools'}
            withName: OUTPUT_UNALIGNED_READS {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/bedtools'}
            withName: 'KAIJU|KAIJU_TAX_TABLE|KAIJU_FULL_TAX_TABLE' {
                conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/kaiju'
                memory = 128.GB
                cpus = 40
            
            }
            withName: MERGE_TAX_FILES {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/R'}
            withName: 'HUMANN.*' { conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/biobakery3'}
            withLabel: megahit {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/megahit'
                                memory = 512.GB
                                cpus = 30
            } 
            withLabel: metabat2 {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/metabat2'
                                 memory = 64.GB
                                 cpus = 30
            }
            withLabel: checkm {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/checkm2'
                                memory = 64.GB
                                cpus = 20
            }
            withName: DREP {conda = '/isilon/sherbrooke-rdc/users/brouardjs/metagenomic_nf/envs/drep2'}
        }
    }
}
